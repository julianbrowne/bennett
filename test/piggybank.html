<html>
<head>
	<title>Bennett Test</title>

	<link rel="stylesheet" media="all" href="../assets/stylesheets/bennett.css" />
	<link rel="stylesheet" media="all" href="../assets/jquery-ui-1.10.3/css/le-frog/jquery-ui-1.10.3.custom.css" />
	<link rel="stylesheet" media="all" href="assets/stylesheets/prettify.css" />
	<link href='http://fonts.googleapis.com/css?family=Jolly+Lodger' rel='stylesheet' type='text/css'>

	<script src="../assets/javascripts/piggybank-0.0.1/jquery.js"></script>
	<script src="../assets/javascripts/piggybank-0.0.1/jquery.cookie.js"></script>
	<script src="../assets/javascripts/piggybank-0.0.1/tv4.js"></script>
	<script src="../assets/javascripts/piggybank-0.0.1/piggybank.js"></script>

	<script src="assets/javascripts/jquery.inspect.js"></script>
	<script src="assets/javascripts/prettify.js"></script>


</head>
<body>
	<h1 class="bennett">Bennett: Piggybank Self-Test</h1>

	<div id="results">
		<pre><code class="prettyprint"></code></pre>
	</div>

	<script type="text/javascript">

	$(function(){

		var manager = new Piggybank("http://127.0.0.1:9191/api");

		//manager.timeout = 5000;
		//manager.ignore404 = true;
		//manager.ignoreErrors = true;
		manager.logger = function(message) { $("#results").append(message); }

		manager.addCall('/login', { 
			method: "post", 
			encoding: 'form', 
			remember: "session", 
			schema: { 
				type: "object",
				properties: { 
					"hubIds": { 
					    "type": "array"
					},
					"ApiSession": { 
					    "type": "string"
					}
				},
				required: [ 
					"hubIds",
					"ApiSession"
				]
			},
			body: { username: "fred", password: "x" }, 
			name: "login fred"
		});

		manager.addCall('/users/fred', {
			method: "get", 
			cookies: {
				ApiSession: { recall: "session.ApiSession" }
			}, 
			name: "get user details"
		});

		manager.addCall('/users/all/search', {
			method: "get", 
			body: { query: "fred" }, 
			encoding: 'form', 
			cookies: { 
				ApiSession: { recall: "session.ApiSession" }
			}, 
			name: "search users"
		});

		manager.addCall('/passwordreset', {
			method: "post", 
			encoding: 'form', 
			body: { username: "fred" }, 
			cookies: {
				ApiSession: { recall: "session.ApiSession" }
			}, 
			name: "password reset"
		});

		manager.addCall('/passwordreset', { 
			method: "get", 
			encoding: 'form', 
			body: { code: "1234" }, 
			cookies: {
				ApiSession: { recall: "session.ApiSession" }
			}, 
			name: "reset check"
		});

		manager.addCall('/logout', { 
			method: "post", 
			cookies: {
				ApiSession: { recall: "session.ApiSession" }
			}, 
			name: "logout fred" 
		});

		// manager.makeCalls().done(publish);

		manager.makeCallsSynchronously().done(publish);

		function publish(data) {
			$("#results pre code").append(JSON.stringify(data, null, 4));
			$("#results pre code").append("\n\r\n\r");
			prettyPrint();
		};
	});

	</script>
</body>
</html>